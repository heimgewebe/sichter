#!/usr/bin/env bash
set -euo pipefail
# blockt push auf main/master, außer ALLOW_MAIN_PUSH=1
cur_branch="$(git rev-parse --abbrev-ref HEAD 2>/dev/null || echo "")"
if [ -z "$cur_branch" ]; then
	exit 0
fi
case "$cur_branch" in
main | master)
	if [ "${ALLOW_MAIN_PUSH:-0}" != "1" ]; then
		echo "❌ Push auf '$cur_branch' blockiert. Bitte Feature-Branch + PR nutzen."
		echo "   (Override nur bewusst: ALLOW_MAIN_PUSH=1 git push …)"
		exit 2
	fi
	;;
esac
exit 0
