#!/usr/bin/env python3
import sys
import os
from pathlib import Path

# Add repo root to path
current_dir = os.path.dirname(os.path.abspath(__file__))
repo_root = os.path.dirname(current_dir)
sys.path.insert(0, repo_root)

from lib.simpleyaml import load

def main():
    if len(sys.argv) < 3:
        # usage: yaml-get <key> <file> [default]
        sys.exit(1)

    key = sys.argv[1]
    filepath = Path(sys.argv[2])
    default_val = sys.argv[3] if len(sys.argv) > 3 else ""

    if not filepath.exists():
        print(default_val)
        return

    try:
        data = load(filepath)
    except Exception:
        print(default_val)
        return

    # Handle potentially nested keys (e.g. key.subkey)
    # Simple recursive lookup
    keys = key.split('.')
    val = data
    for k in keys:
        if isinstance(val, dict):
            val = val.get(k)
        else:
            val = None
            break

    if val is None:
        print(default_val)
        return

    if isinstance(val, bool):
        print("true" if val else "false")
    elif isinstance(val, list):
        for item in val:
            print(str(item))
    elif isinstance(val, dict):
        # For dicts, we might not want to output anything or json?
        # For now, print string representation to avoid silence
        print(str(val))
    else:
        print(str(val))

if __name__ == "__main__":
    main()
