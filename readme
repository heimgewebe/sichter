Alles klar âœ… â€” hier ist eine **idempotente README** fÃ¼r dein HausKI-System. Sie beschreibt den aktuellen Stand mit Auto-Review, Auto-Fix & Auto-Push fÃ¼r alle PRs (Org + User).

---

````bash
#!/usr/bin/env bash
# === HausKI README-Builder ===
set -euo pipefail
DOC="$HOME/sichter/README.md"
mkdir -p "$(dirname "$DOC")"

cat > "$DOC" <<'MD'
# ğŸ  HausKI â€¢ Auto Review & Fix (v1.6)

## ğŸ§  Ãœberblick
- Vollautomatische Reviews fÃ¼r Organisations- **und** persÃ¶nliche Repositories (`HAUSKI_PR_SCOPE=both`).
- `hauski-pr-watch` erkennt neue PRs, reviewed tief, wendet Fixes an und pusht sie â€“ sofern Maintainer-Rechte oder eigener Branch.
- Auto-Apply (`HAUSKI_REMOTE_AUTO_APPLY=1`) & Auto-Commit (`HAUSKI_REMOTE_AUTO_COMMIT=1`) laufen standardmÃ¤ÃŸig; `hauski-pr-suggest` ergÃ¤nzt kommentierbare Diffs.
- Dashboard v4 zeigt die letzten LÃ¤ufe pro Repo mit Verdict, Score und GrÃ¶ÃŸe.
- Dateisystem-Watcher (`hauski-watch` + `hauski-work`) verarbeiten lokale Ã„nderungen unmittelbar.

---

## ğŸ”§ Architektur-Bausteine
- **Hook `hooks/post-run`**
  - fÃ¼hrt `pr-review --local --fast --heavy` aus
  - erzeugt Reports (`review/<repo>/<timestamp>-review.md`) & aktualisiert `review/index.json`
  - legt `sichter-reports`-Symlink, baut Dashboard, verschickt Notifications
  - triggert Auto-Apply, Auto-Commit und `hauski-pr-suggest`
- **PR-Automation `hauski-pr-watch`**
  - Scope via `HAUSKI_PR_SCOPE` (`org`, `user`, `both`, `auto`), kombiniert mit `HAUSKI_INCLUDE_AUTHORED`
  - spiegelt Repos nach `~/sichter/repos`, erzeugt Worktrees unter `~/sichter/pr-worktrees`
  - richtet bei Push-Freigabe ein Head-Remote ein (oder nutzt `origin`) und pusht neue Commits nach `head.ref`
- **Dateisystem-Dienste**
  - `hauski-watch` Ã¼berwacht `~/repos` (inotify, Debounce 3â€¯s)
  - `hauski-work` entkoppelt Jobs, limitiert jeden Hook auf 15â€¯min (Timeout) und serialisiert pro Repo (`flock`)
  - `hauski-autopilot` sorgt dafÃ¼r, dass Watcher, Worker und PR-Watcher dauerhaft laufen (systemd user service empfohlen)
- **Dashboard v4**
  - statisches HTML (`review/dashboard.html`) mit Suche, Filtern, CSV-Export und â€nur letzter Runâ€œ-Ansicht

---

## ğŸ”„ Automatischer PR-Flow
1. **Erkennen** â€“ `hauski-pr-watch` pollt Repos & eigene offenen PRs; Head-SHAs landen in `review/pr-reviewed.json`.
2. **Mirror & Worktree** â€“ PR-Head wird als Branch `hauski/pr-<NR>` gefetched, Worktree erzeugt, `sichter-enable` gesetzt.
3. **Review & Fix** â€“ Hook lÃ¤uft mit Auto-Apply/Commit, `hauski-pr-suggest` postet kommentierbare Diffs.
4. **Push** â€“ Bei Schreibrechten (`maintainer_can_modify`, eigener Branch oder eigener Fork) erfolgt `git push <remote> <branch>:<head.ref>` direkt in den PR.
5. **AufrÃ¤umen** â€“ Worktree & temporÃ¤re Remotes werden entfernt, Push-Status optional im Statefile vermerkt.

> âš ï¸ Kein Push, wenn der Head-Remote nicht erreichbar ist oder keine neuen Commits entstanden â€“ in dem Fall bleibt nur der Kommentar + Report.

---

## âš™ï¸ Konfiguration & Defaults
| Variable | Default | Wirkung |
| --- | --- | --- |
| `HAUSKI_PR_SCOPE` | `both` | `org`, `user`, `both` oder `auto` (auto nutzt nur gesetzte Werte) |
| `HAUSKI_ORG` | `heimgewebe` | Organisations-Repos scannen |
| `HAUSKI_USER` | `alexdermohr` | Eigene Repos berÃ¼cksichtigen |
| `HAUSKI_INCLUDE_AUTHORED` | `1` | Eigene offenen PRs (via Search-API) hinzufÃ¼gen |
| `HAUSKI_REMOTE_AUTO_APPLY` | `1` | Nach Review automatisch `hauski-apply` ausfÃ¼hren |
| `HAUSKI_REMOTE_AUTO_COMMIT` | `1` | Nach Apply committen & (ggf.) pushen |
| `HAUSKI_REMOTE_AUTO_PR` | `0` | Kein Draft-PR erstellen (wir pushen in bestehende Branches) |
| `HAUSKI_PR_TIMEOUT` | `20m` | Timeout pro PR-Lauf |

Anpassungen erfolgen in `~/sichter/autostart.env`; danach `systemctl --user restart hauski-autopilot.service`.

---

## ğŸš€ Manuelle Workflows
- Aktuelles Repo: `hauski-run`
- Alle Repos unter `~/repos`: `hauski-review-all`
- Offene PRs im aktuellen Git-Projekt: `hauski-pr-review-all`
- Status & Dashboard: `hauski-status summary`, `hauski-dashboard`

> FÃ¼r einmalige LÃ¤ufe bleiben die Shell-Flags gÃ¼ltig: `HAUSKI_AUTO_APPLY=1`, `HAUSKI_AUTO_COMMIT=1`, `HAUSKI_AUTO_PR=0`.

---

## ğŸ›¡ï¸ Safety & Guardrails
- `hauski-guard-branch` blockiert Pushes auf `main/master` (Override: `ALLOW_MAIN_PUSH=1 git push`).
- Push nur bei vorhandenen Rechten; ansonsten bleiben Fixes lokal bzw. als Kommentar.
- `denylist.paths` verhindert versehentliches Stagen von Artefakten (`node_modules`, `target`, â€¦).
- Repo-Locks (`flock`) + Worktrees stellen sicher, dass parallele LÃ¤ufe sauber getrennt sind.

---

## ğŸ—‚ï¸ Datenlayout
```
~/sichter/
 â”œâ”€â”€ bin/                 # CLI-Tools & Worker
 â”œâ”€â”€ hooks/post-run       # HerzstÃ¼ck der Review-Pipeline
 â”œâ”€â”€ review/
 â”‚    â”œâ”€â”€ <repo>/<ts>-review.md
 â”‚    â”œâ”€â”€ index.json
 â”‚    â””â”€â”€ dashboard.html
 â”œâ”€â”€ queue/               # Jobs vom Dateisystem-Watcher
 â”œâ”€â”€ tmp/                 # Locks & Zwischendateien
 â””â”€â”€ logs/                # review.log, watch.log, pr-watch.log, â€¦
```

---

## ğŸ” Monitoring & Troubleshooting
- `hauski-status logs` â†’ sammelt aktuelle Review-/Watch-/Worker-Logs
- `tail -f ~/sichter/logs/pr-watch.log` â†’ PR-Automation live verfolgen
- `hauski-doctor-migrate` â†’ repariert Dashboard/Index, falls leer
- `HAUSKI_DEBUG=1 hauski-pr-watch` â†’ zusÃ¤tzliche Diagnosen fÃ¼r den Watcher

---

## ğŸ“œ Version
HausKI v1.6 â€¢ Dashboard v4 â€¢ PR-Automation v3.0 â€¢ Auto-Push Pilot aktiv
MD

echo "âœ… README aktualisiert: $DOC"

```

---

ğŸ“Œ **Anwendung:**
Einmal ausfÃ¼hren â†’ aktualisiert `~/sichter/README.md`. Wiederholte AusfÃ¼hrung ist safe (idempotent).

